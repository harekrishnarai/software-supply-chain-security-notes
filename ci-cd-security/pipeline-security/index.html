<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A comprehensive resource for understanding and implementing software supply chain security."><meta name=author content="Hare Krishna Rai"><link href=../../secure-development/secure-coding/ rel=prev><link href=../artifact-signing/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Pipeline Security - Software Supply Chain Security Notes</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../assets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#security-measures-for-cicd-pipelines class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Software Supply Chain Security Notes" class="md-header__button md-logo" aria-label="Software Supply Chain Security Notes" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 19h1a1 1 0 0 1 1 1h7v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-1.66C8.07 16.13 6 13 6 9.67v-4L12 3l6 2.67v4c0 3.33-2.07 6.46-5 7.67zM12 5 8 6.69V10h4zm0 5v6c1.91-.47 4-2.94 4-5v-1z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Software Supply Chain Security Notes </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Pipeline Security </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 6c1.4 0 2.8 1.1 2.8 2.5V11c.6 0 1.2.6 1.2 1.3v3.5c0 .6-.6 1.2-1.3 1.2H9.2c-.6 0-1.2-.6-1.2-1.3v-3.5c0-.6.6-1.2 1.2-1.2V9.5C9.2 8.1 10.6 7 12 7m0 1.2c-.8 0-1.5.5-1.5 1.3V11h3V9.5c0-.8-.7-1.3-1.5-1.3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=cyan data-md-color-accent=deep-orange aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 11c0 5.55-3.84 10.74-9 12-5.16-1.26-9-6.45-9-12V5l9-4 9 4zm-9 10c3.75-1 7-5.46 7-9.78V6.3l-7-3.12L5 6.3v4.92C5 15.54 8.25 20 12 21m2.8-10V9.5C14.8 8.1 13.4 7 12 7S9.2 8.1 9.2 9.5V11c-.6 0-1.2.6-1.2 1.2v3.5c0 .7.6 1.3 1.2 1.3h5.5c.7 0 1.3-.6 1.3-1.2v-3.5c0-.7-.6-1.3-1.2-1.3m-1.3 0h-3V9.5c0-.8.7-1.3 1.5-1.3s1.5.5 1.5 1.3z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/harekrishnarai/software-supply-chain-security-notes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Software Supply Chain Security Notes" class="md-nav__button md-logo" aria-label="Software Supply Chain Security Notes" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 19h1a1 1 0 0 1 1 1h7v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-1.66C8.07 16.13 6 13 6 9.67v-4L12 3l6 2.67v4c0 3.33-2.07 6.46-5 7.67zM12 5 8 6.69V10h4zm0 5v6c1.91-.47 4-2.94 4-5v-1z"/></svg> </a> Software Supply Chain Security Notes </label> <div class=md-nav__source> <a href=https://github.com/harekrishnarai/software-supply-chain-security-notes title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Introduction </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../introduction/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../introduction/terminology/ class=md-nav__link> <span class=md-ellipsis> Terminology </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Risk Assessment </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Risk Assessment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../risk-assessment/threat-modeling/ class=md-nav__link> <span class=md-ellipsis> Threat Modeling </span> </a> </li> <li class=md-nav__item> <a href=../../risk-assessment/vulnerability-management/ class=md-nav__link> <span class=md-ellipsis> Vulnerability Management </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Secure Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Secure Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../secure-development/dependency-management/ class=md-nav__link> <span class=md-ellipsis> Dependency Management </span> </a> </li> <li class=md-nav__item> <a href=../../secure-development/sbom/ class=md-nav__link> <span class=md-ellipsis> SBOM </span> </a> </li> <li class=md-nav__item> <a href=../../secure-development/secure-coding/ class=md-nav__link> <span class=md-ellipsis> Secure Coding </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> CI/CD Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> CI/CD Security </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Pipeline Security </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Pipeline Security </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cicd-pipeline-architecture-and-security-considerations class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline Architecture and Security Considerations </span> </a> </li> <li class=md-nav__item> <a href=#understanding-cicd-pipeline-risks class=md-nav__link> <span class=md-ellipsis> Understanding CI/CD Pipeline Risks </span> </a> </li> <li class=md-nav__item> <a href=#key-cicd-security-controls class=md-nav__link> <span class=md-ellipsis> Key CI/CD Security Controls </span> </a> <nav class=md-nav aria-label="Key CI/CD Security Controls"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-access-controls-and-permissions class=md-nav__link> <span class=md-ellipsis> 1. Access Controls and Permissions </span> </a> </li> <li class=md-nav__item> <a href=#2-secure-pipeline-configuration class=md-nav__link> <span class=md-ellipsis> 2. Secure Pipeline Configuration </span> </a> </li> <li class=md-nav__item> <a href=#3-isolated-build-environments class=md-nav__link> <span class=md-ellipsis> 3. Isolated Build Environments </span> </a> </li> <li class=md-nav__item> <a href=#4-secret-management class=md-nav__link> <span class=md-ellipsis> 4. Secret Management </span> </a> </li> <li class=md-nav__item> <a href=#5-dependency-and-vulnerability-scanning class=md-nav__link> <span class=md-ellipsis> 5. Dependency and Vulnerability Scanning </span> </a> </li> <li class=md-nav__item> <a href=#6-artifact-signing-and-verification class=md-nav__link> <span class=md-ellipsis> 6. Artifact Signing and Verification </span> </a> </li> <li class=md-nav__item> <a href=#7-immutable-and-verifiable-builds class=md-nav__link> <span class=md-ellipsis> 7. Immutable and Verifiable Builds </span> </a> </li> <li class=md-nav__item> <a href=#8-monitoring-and-logging class=md-nav__link> <span class=md-ellipsis> 8. Monitoring and Logging </span> </a> </li> <li class=md-nav__item> <a href=#9-security-testing-integration class=md-nav__link> <span class=md-ellipsis> 9. Security Testing Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cicd-security-maturity-model class=md-nav__link> <span class=md-ellipsis> CI/CD Security Maturity Model </span> </a> <nav class=md-nav aria-label="CI/CD Security Maturity Model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#level-1-basic-security class=md-nav__link> <span class=md-ellipsis> Level 1: Basic Security </span> </a> </li> <li class=md-nav__item> <a href=#level-2-standard-security class=md-nav__link> <span class=md-ellipsis> Level 2: Standard Security </span> </a> </li> <li class=md-nav__item> <a href=#level-3-advanced-security class=md-nav__link> <span class=md-ellipsis> Level 3: Advanced Security </span> </a> </li> <li class=md-nav__item> <a href=#level-4-leading-practice class=md-nav__link> <span class=md-ellipsis> Level 4: Leading Practice </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion-and-recommended-actions class=md-nav__link> <span class=md-ellipsis> Conclusion and Recommended Actions </span> </a> </li> <li class=md-nav__item> <a href=#pipeline-security-assessment-guide class=md-nav__link> <span class=md-ellipsis> Pipeline Security Assessment Guide </span> </a> <nav class=md-nav aria-label="Pipeline Security Assessment Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#assessment-methodology class=md-nav__link> <span class=md-ellipsis> Assessment Methodology </span> </a> </li> <li class=md-nav__item> <a href=#cicd-security-audit-checklist class=md-nav__link> <span class=md-ellipsis> CI/CD Security Audit Checklist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pipeline-security-architecture-patterns class=md-nav__link> <span class=md-ellipsis> Pipeline Security Architecture Patterns </span> </a> <nav class=md-nav aria-label="Pipeline Security Architecture Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pattern-1-defense-in-depth-pipeline-architecture class=md-nav__link> <span class=md-ellipsis> Pattern 1: Defense in Depth Pipeline Architecture </span> </a> </li> <li class=md-nav__item> <a href=#pattern-2-secure-multi-environment-pipeline class=md-nav__link> <span class=md-ellipsis> Pattern 2: Secure Multi-Environment Pipeline </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#practical-implementation-guide class=md-nav__link> <span class=md-ellipsis> Practical Implementation Guide </span> </a> <nav class=md-nav aria-label="Practical Implementation Guide"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementing-pipeline-security-in-github-actions class=md-nav__link> <span class=md-ellipsis> Implementing Pipeline Security in GitHub Actions </span> </a> </li> <li class=md-nav__item> <a href=#implementing-pipeline-security-in-gitlab-ci class=md-nav__link> <span class=md-ellipsis> Implementing Pipeline Security in GitLab CI </span> </a> </li> <li class=md-nav__item> <a href=#implementing-pipeline-security-in-azure-devops class=md-nav__link> <span class=md-ellipsis> Implementing Pipeline Security in Azure DevOps </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-pipeline-security-techniques class=md-nav__link> <span class=md-ellipsis> Advanced Pipeline Security Techniques </span> </a> <nav class=md-nav aria-label="Advanced Pipeline Security Techniques"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#binary-authorization-and-policy-enforcement class=md-nav__link> <span class=md-ellipsis> Binary Authorization and Policy Enforcement </span> </a> </li> <li class=md-nav__item> <a href=#pipeline-security-monitoring class=md-nav__link> <span class=md-ellipsis> Pipeline Security Monitoring </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion-and-recommended-actions_1 class=md-nav__link> <span class=md-ellipsis> Conclusion and Recommended Actions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../artifact-signing/ class=md-nav__link> <span class=md-ellipsis> Artifact Signing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/scanners/ class=md-nav__link> <span class=md-ellipsis> Scanners </span> </a> </li> <li class=md-nav__item> <a href=../../tools/monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Best Practices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Best Practices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../best-practices/standards/ class=md-nav__link> <span class=md-ellipsis> Standards </span> </a> </li> <li class=md-nav__item> <a href=../../best-practices/frameworks/ class=md-nav__link> <span class=md-ellipsis> Frameworks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=security-measures-for-cicd-pipelines>Security Measures for CI/CD Pipelines<a class=headerlink href=#security-measures-for-cicd-pipelines title="Permanent link">&para;</a></h1> <div class=secure-component> <span class="security-badge badge-warning">CRITICAL INFRASTRUCTURE</span> CI/CD pipelines represent a high-value target for attackers seeking to compromise software supply chains. This guide provides comprehensive security controls to protect these essential systems. </div> <p>In the modern software development landscape, Continuous Integration and Continuous Deployment (CI/CD) pipelines play a crucial role in automating the software delivery process. However, these pipelines can also introduce security vulnerabilities if not properly managed. This document outlines key security measures that should be implemented to ensure the integrity and security of CI/CD pipelines.</p> <h2 id=cicd-pipeline-architecture-and-security-considerations>CI/CD Pipeline Architecture and Security Considerations<a class=headerlink href=#cicd-pipeline-architecture-and-security-considerations title="Permanent link">&para;</a></h2> <pre class=mermaid><code>graph LR
    classDef secure fill:#6f6, stroke:#333, stroke-width:2px
    classDef vulnerable fill:#f96, stroke:#333, stroke-width:2px
    classDef standard fill:#69f, stroke:#333, stroke-width:2px, color:white
    classDef control fill:#fc9, stroke:#333, stroke-width:1px

    A[Developer\nWorkstation] --&gt;|Push Code| B[Source Code\nRepository]
    B --&gt;|Trigger Build| C[CI/CD Server]
    C --&gt;|Pull Dependencies| D[Package\nRegistry]
    C --&gt;|Run Tests| E[Test\nEnvironment]
    C --&gt;|Deploy| F[Staging\nEnvironment]
    F --&gt;|Promote| G[Production\nEnvironment]

    S1[Access\nControls] -.-&gt; B
    S2[Code Signing] -.-&gt; B
    S3[Pipeline as Code\nReview] -.-&gt; C
    S4[Isolated Build\nEnvironments] -.-&gt; C
    S5[Dependency\nScanning] -.-&gt; D
    S6[Secret\nManagement] -.-&gt; C
    S7[Artifact\nSigning] -.-&gt; F
    S8[Immutable\nDeployments] -.-&gt; G

    class A,B,C,D,E,F,G standard
    class S1,S2,S3,S4,S5,S6,S7,S8 control

    click S1 href "#access-controls-and-permissions" "Learn about Access Controls"
    click S4 href "#isolated-build-environments" "Learn about Isolated Build Environments"
    click S6 href "#secret-management" "Learn about Secret Management"
    click S7 href "#artifact-signing-and-verification" "Learn about Artifact Signing"</code></pre> <h2 id=understanding-cicd-pipeline-risks>Understanding CI/CD Pipeline Risks<a class=headerlink href=#understanding-cicd-pipeline-risks title="Permanent link">&para;</a></h2> <p>CI/CD pipelines face several security risks that can compromise the integrity of your software:</p> <table> <thead> <tr> <th>Risk Category</th> <th>Description</th> <th>Potential Impact</th> </tr> </thead> <tbody> <tr> <td><strong>Unauthorized Access</strong></td> <td>Attackers gaining access to build systems</td> <td>Code tampering, credential theft</td> </tr> <tr> <td><strong>Supply Chain Injection</strong></td> <td>Malicious code or dependencies inserted during build</td> <td>Backdoors, data exfiltration</td> </tr> <tr> <td><strong>Credential Exposure</strong></td> <td>Sensitive keys and tokens exposed in build logs or scripts</td> <td>Account compromise, lateral movement</td> </tr> <tr> <td><strong>Insecure Pipeline Configuration</strong></td> <td>Misconfigured pipelines allowing security bypasses</td> <td>Bypassed security controls</td> </tr> <tr> <td><strong>Tampering with Build Artifacts</strong></td> <td>Unauthorized modifications to compiled code or containers</td> <td>Distribution of compromised software</td> </tr> </tbody> </table> <div class="admonition warning"> <p class=admonition-title>The Codecov Attack</p> <p>In 2021, attackers compromised the bash uploader script at Codecov, a popular code coverage tool. This allowed them to exfiltrate environment variables and secrets from thousands of CI/CD pipelines that used the tool. This attack demonstrates how a compromised build tool can lead to widespread supply chain breaches.</p> </div> <h2 id=key-cicd-security-controls>Key CI/CD Security Controls<a class=headerlink href=#key-cicd-security-controls title="Permanent link">&para;</a></h2> <h3 id=1-access-controls-and-permissions>1. Access Controls and Permissions<a class=headerlink href=#1-access-controls-and-permissions title="Permanent link">&para;</a></h3> <p>Implement strict access controls to limit who can modify pipelines or deploy code:</p> <pre class=mermaid><code>flowchart TD
    classDef role fill:#6a89cc, stroke:#333, stroke-width:1px, color:white
    classDef permission fill:#82ccdd, stroke:#333, stroke-width:1px

    A[CI/CD Access Control]
    A --&gt; B[Developer Role]:::role
    A --&gt; C[DevOps Role]:::role
    A --&gt; D[Security Role]:::role
    A --&gt; E[Release Manager Role]:::role

    B --&gt; B1[Commit Code]:::permission
    B --&gt; B2[Initialize Pipelines]:::permission

    C --&gt; C1[Configure Build Environments]:::permission
    C --&gt; C2[Define Pipeline Steps]:::permission

    D --&gt; D1[Security Scan Configuration]:::permission
    D --&gt; D2[Approval Gates]:::permission

    E --&gt; E1[Production Deployment]:::permission
    E --&gt; E2[Release Signing]:::permission</code></pre> <ul> <li><strong>Implement Role-Based Access Control (RBAC)</strong> with least privilege principles</li> <li><strong>Separate duties</strong> between pipeline configuration and code deployment</li> <li><strong>Require Multi-Factor Authentication</strong> for all CI/CD system access</li> <li><strong>Audit access regularly</strong> and remove permissions for team members who no longer need them</li> <li><strong>Implement protected branches</strong> requiring code reviews before merging</li> </ul> <p><strong>Example GitHub Protected Branch Configuration:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># .github/settings.yml</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nt>branches</span><span class=p>:</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=nt>protection</span><span class=p>:</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>      </span><span class=nt>required_pull_request_reviews</span><span class=p>:</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>        </span><span class=nt>required_approving_review_count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>        </span><span class=nt>dismiss_stale_reviews</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>        </span><span class=nt>require_code_owner_reviews</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>      </span><span class=nt>required_status_checks</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>        </span><span class=nt>strict</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>        </span><span class=nt>contexts</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;security/scan&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;tests&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>      </span><span class=nt>enforce_admins</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>      </span><span class=nt>restrictions</span><span class=p>:</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>        </span><span class=nt>users</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[]</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>        </span><span class=nt>teams</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;release-managers&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p> <h3 id=2-secure-pipeline-configuration>2. Secure Pipeline Configuration<a class=headerlink href=#2-secure-pipeline-configuration title="Permanent link">&para;</a></h3> <p>Ensure that CI/CD pipelines are secured from initial configuration:</p> <ul> <li><strong>Use Pipeline as Code</strong> with all pipeline definitions stored in version-controlled repositories</li> <li><strong>Validate pipeline configuration files</strong> through linting and security scanning</li> <li><strong>Implement configuration drift detection</strong> to prevent unauthorized changes</li> <li><strong>Keep CI/CD systems and runners updated</strong> with security patches</li> <li><strong>Disable features not in use</strong> to reduce attack surface</li> </ul> <p><strong>Example GitLab CI Security Configuration:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># .gitlab-ci.yml</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>variables</span><span class=p>:</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>  </span><span class=nt>SECURE_FILES_ENABLED</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>  </span><span class=nt>SECURE_ANALYZERS_PREFIX</span><span class=p>:</span><span class=w> </span><span class=s>&quot;registry.gitlab.com/security-products&quot;</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/SAST.gitlab-ci.yml</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/Dependency-Scanning.gitlab-ci.yml</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/Secret-Detection.gitlab-ci.yml</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=nt>stages</span><span class=p>:</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=c1># Job definitions would follow...</span>
</span></code></pre></div></p> <h3 id=3-isolated-build-environments>3. Isolated Build Environments<a class=headerlink href=#3-isolated-build-environments title="Permanent link">&para;</a></h3> <p>Implement isolated, ephemeral build environments to prevent cross-contamination and ensure clean builds:</p> <ul> <li><strong>Use containerized builds</strong> that start fresh for each pipeline run</li> <li><strong>Implement infrastructure as code</strong> for build environment consistency</li> <li><strong>Regularly rotate build agents/runners</strong> to prevent persistent compromises</li> <li><strong>Ensure network isolation</strong> of build environments from production systems</li> <li><strong>Use separate build agents</strong> for different security tiers of projects</li> </ul> <p><strong>Example Docker Build Configuration:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># .github/workflows/build.yml</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>    </span><span class=nt>container</span><span class=p>:</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--read-only --tmpfs /tmp:exec --network-alias build</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>      </span><span class=c1># Build steps follow...</span>
</span></code></pre></div></p> <h3 id=4-secret-management>4. Secret Management<a class=headerlink href=#4-secret-management title="Permanent link">&para;</a></h3> <p>Implement robust secret management practices to prevent credentials from being exposed:</p> <ul> <li><strong>Use a dedicated secret management service</strong> like HashiCorp Vault, AWS Secrets Manager, or Azure Key Vault</li> <li><strong>Rotate secrets regularly</strong> and after team member departures</li> <li><strong>Implement just-in-time access</strong> for credentials needed during builds</li> <li><strong>Audit secret usage</strong> to detect abnormal access patterns</li> <li><strong>Scan repositories and build logs</strong> to detect accidentally committed secrets</li> </ul> <p><strong>Example Jenkins Credential Management:</strong> <div class="language-groovy highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>// Jenkinsfile</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>pipeline</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=n>agent</span><span class=w> </span><span class=n>any</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=n>environment</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>        </span><span class=c1>// Credentials defined in Jenkins credential store</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>        </span><span class=n>AWS_CREDS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>credentials</span><span class=o>(</span><span class=s1>&#39;aws-deploy-credentials&#39;</span><span class=o>)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>    </span><span class=n>stages</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Deploy&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>                </span><span class=c1>// AWS credentials injected as environment variables</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>                </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;aws s3 cp ./dist s3://my-bucket/ --recursive&#39;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=o>}</span>
</span></code></pre></div></p> <h3 id=5-dependency-and-vulnerability-scanning>5. Dependency and Vulnerability Scanning<a class=headerlink href=#5-dependency-and-vulnerability-scanning title="Permanent link">&para;</a></h3> <p>Implement comprehensive scanning to detect vulnerabilities throughout the build process:</p> <ul> <li><strong>Scan all dependencies</strong> for known vulnerabilities before including them</li> <li><strong>Use Software Composition Analysis (SCA)</strong> tools to create and maintain SBOMs</li> <li><strong>Implement policy-based blocking</strong> of builds with critical vulnerabilities</li> <li><strong>Continuously monitor for new vulnerabilities</strong> in existing dependencies</li> <li><strong>Scan container images</strong> before deployment and in runtime</li> </ul> <p><strong>Example GitHub Action for Dependency Scanning:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># .github/workflows/security.yml</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security Scan</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>push</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>pull_request</span><span class="p p-Indicator">]</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>  </span><span class=nt>scan</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run Trivy vulnerability scanner</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/trivy-action@master</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>          </span><span class=nt>scan-type</span><span class=p>:</span><span class=w> </span><span class=s>&#39;fs&#39;</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>          </span><span class=nt>scan-ref</span><span class=p>:</span><span class=w> </span><span class=s>&#39;.&#39;</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>          </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&#39;table&#39;</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>          </span><span class=nt>exit-code</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1&#39;</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>          </span><span class=nt>ignore-unfixed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&#39;CRITICAL,HIGH&#39;</span>
</span></code></pre></div></p> <h3 id=6-artifact-signing-and-verification>6. Artifact Signing and Verification<a class=headerlink href=#6-artifact-signing-and-verification title="Permanent link">&para;</a></h3> <p>Implement cryptographic signing to ensure the integrity of build artifacts:</p> <pre class=mermaid><code>sequenceDiagram
    participant Builder as CI/CD Builder
    participant Registry as Artifact Registry
    participant Deployer as Deployment System

    Builder-&gt;&gt;Builder: Generate build artifact
    Builder-&gt;&gt;Builder: Calculate artifact hash
    Builder-&gt;&gt;Builder: Sign hash with private key
    Builder-&gt;&gt;Registry: Upload artifact + signature

    Deployer-&gt;&gt;Registry: Download artifact + signature
    Deployer-&gt;&gt;Deployer: Verify signature with public key
    Deployer-&gt;&gt;Deployer: Calculate artifact hash
    Deployer-&gt;&gt;Deployer: Compare to signed hash

    Note over Deployer: Deploy only if signature is valid</code></pre> <ul> <li><strong>Implement code signing</strong> with properly secured private keys</li> <li><strong>Use hardware security modules (HSMs)</strong> for critical signing operations</li> <li><strong>Establish a chain of trust</strong> by signing all artifacts (containers, packages, binaries)</li> <li><strong>Verify signatures before deployment</strong> as an automated step</li> <li><strong>Implement key rotation procedures</strong> and secure backup of signing keys</li> </ul> <p><strong>Example Sigstore/Cosign Container Signing:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Sign a container image</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>cosign<span class=w> </span>sign<span class=w> </span>--key<span class=w> </span>cosign.key<span class=w> </span><span class=se>\</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span>my-registry.example.com/my-app:v1.0.0
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=c1># Verify a container image</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>cosign<span class=w> </span>verify<span class=w> </span>--key<span class=w> </span>cosign.pub<span class=w> </span><span class=se>\</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>  </span>my-registry.example.com/my-app:v1.0.0
</span></code></pre></div></p> <h3 id=7-immutable-and-verifiable-builds>7. Immutable and Verifiable Builds<a class=headerlink href=#7-immutable-and-verifiable-builds title="Permanent link">&para;</a></h3> <p>Implement reproducible builds to ensure consistency and detect tampering:</p> <ul> <li><strong>Use deterministic build processes</strong> that produce identical outputs for the same inputs</li> <li><strong>Record build provenance data</strong> including source code commit, build environment, and dependencies</li> <li><strong>Store build logs securely</strong> for audit purposes</li> <li><strong>Create verifiable build attestations</strong> documenting the build process</li> <li><strong>Implement binary transparency</strong> to track changes in build outputs over time</li> </ul> <p><strong>Example SLSA Build Provenance:</strong> <div class="language-json highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=p>{</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>  </span><span class=nt>&quot;builder&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;https://github.com/actions/runner&quot;</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=nt>&quot;buildType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;https://github.com/actions/runner/build&quot;</span><span class=p>,</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>  </span><span class=nt>&quot;invocation&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=nt>&quot;configSource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>      </span><span class=nt>&quot;uri&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;git+https://github.com/example/repo@refs/heads/main&quot;</span><span class=p>,</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>      </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;sha1&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;abc123&quot;</span><span class=p>}</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span><span class=nt>&quot;parameters&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{},</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class=nt>&quot;environment&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>      </span><span class=nt>&quot;github_event_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;push&quot;</span><span class=p>,</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>      </span><span class=nt>&quot;github_run_id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1234567890&quot;</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>  </span><span class=nt>&quot;buildConfig&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>    </span><span class=nt>&quot;commands&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;npm ci&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;npm run build&quot;</span><span class=p>]</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>  </span><span class=nt>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>    </span><span class=nt>&quot;completeness&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=w>      </span><span class=nt>&quot;parameters&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>      </span><span class=nt>&quot;environment&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>      </span><span class=nt>&quot;materials&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>    </span><span class=nt>&quot;reproducible&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>  </span><span class=p>},</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a><span class=w>  </span><span class=nt>&quot;materials&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>      </span><span class=nt>&quot;uri&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;git+https://github.com/example/repo@refs/heads/main&quot;</span><span class=p>,</span>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>      </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;sha1&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;abc123&quot;</span><span class=p>}</span>
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>      </span><span class=nt>&quot;uri&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pkg:npm/left-pad@1.3.0&quot;</span><span class=p>,</span>
</span><span id=__span-6-35><a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>      </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;sha512&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;def456&quot;</span><span class=p>}</span>
</span><span id=__span-6-36><a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-37><a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-6-38><a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=p>}</span>
</span></code></pre></div></p> <h3 id=8-monitoring-and-logging>8. Monitoring and Logging<a class=headerlink href=#8-monitoring-and-logging title="Permanent link">&para;</a></h3> <p>Implement comprehensive monitoring to detect security issues in real-time:</p> <ul> <li><strong>Centralize and secure logs</strong> from all pipeline components</li> <li><strong>Implement log integrity mechanisms</strong> to prevent tampering</li> <li><strong>Set up anomaly detection</strong> for unusual pipeline behavior</li> <li><strong>Monitor for unauthorized changes</strong> to pipeline configurations</li> <li><strong>Establish alert thresholds</strong> for suspicious activities, like unusual build times or resources</li> </ul> <p><strong>Example ELK Stack Configuration for CI/CD Monitoring:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># filebeat.yml for CI/CD logs</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nt>filebeat.inputs</span><span class=p>:</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">log</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>  </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/jenkins/jenkins.log</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/github-actions/*.log</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>  </span><span class=nt>fields</span><span class=p>:</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ci_cd</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=nt>output.elasticsearch</span><span class=p>:</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;elasticsearch:9200&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>  </span><span class=nt>index</span><span class=p>:</span><span class=w> </span><span class=s>&quot;cicd-logs-%{+yyyy.MM.dd}&quot;</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=c1># Alert rule example</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class="l l-Scalar l-Scalar-Plain">PUT _watcher/watch/unusual_build_time</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class="p p-Indicator">{</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>  </span><span class=s>&quot;trigger&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;schedule&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;interval&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;10m&quot;</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">},</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>  </span><span class=s>&quot;input&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>    </span><span class=s>&quot;search&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>      </span><span class=s>&quot;request&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>        </span><span class=s>&quot;indices&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;cicd-logs-*&quot;</span><span class="p p-Indicator">],</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>        </span><span class=s>&quot;body&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>          </span><span class=s>&quot;query&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>            </span><span class=s>&quot;bool&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>              </span><span class=s>&quot;must&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">[</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>                </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;range&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;build.duration&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;gt&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=nv>3600</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">},</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>                </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;term&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;project.name&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;critical-app&quot;</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>              </span><span class="p p-Indicator">]</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w>            </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w>          </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w>        </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=w>      </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w>    </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>  </span><span class="p p-Indicator">},</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w>  </span><span class=s>&quot;condition&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;compare&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;ctx.payload.hits.total&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span><span class=w> </span><span class=s>&quot;gt&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=nv>0</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">}</span><span class=w> </span><span class="p p-Indicator">},</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=w>  </span><span class=s>&quot;actions&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=w>    </span><span class=s>&quot;notify_security&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a><span class=w>      </span><span class=s>&quot;webhook&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>        </span><span class=s>&quot;scheme&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;https&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=w>        </span><span class=s>&quot;host&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;alerts.example.com&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=w>        </span><span class=s>&quot;port&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=nv>443</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=w>        </span><span class=s>&quot;method&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;post&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=w>        </span><span class=s>&quot;path&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;/api/alert&quot;</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=w>        </span><span class=s>&quot;params&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{},</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a><span class=w>        </span><span class=s>&quot;headers&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class="p p-Indicator">{},</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=w>        </span><span class=s>&quot;body&quot;</span><span class="p p-Indicator">:</span><span class=w> </span><span class=s>&quot;Unusual</span><span class=nv> </span><span class=s>build</span><span class=nv> </span><span class=s>time</span><span class=nv> </span><span class=s>detected</span><span class=nv> </span><span class=s>for</span><span class=nv> </span><span class=s>critical-app&quot;</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a><span class=w>      </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=w>    </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a><span class=w>  </span><span class="p p-Indicator">}</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class="p p-Indicator">}</span>
</span></code></pre></div></p> <h3 id=9-security-testing-integration>9. Security Testing Integration<a class=headerlink href=#9-security-testing-integration title="Permanent link">&para;</a></h3> <p>Incorporate comprehensive security testing into your pipeline:</p> <ul> <li><strong>Implement Static Application Security Testing (SAST)</strong> to detect code vulnerabilities</li> <li><strong>Use Dynamic Application Security Testing (DAST)</strong> for running application testing</li> <li><strong>Perform Infrastructure as Code (IaC) security scans</strong> on deployment templates</li> <li><strong>Implement container security scanning</strong> before deployment</li> <li><strong>Schedule regular penetration tests</strong> of the pipeline itself</li> </ul> <p><strong>Example Multi-Layer Security Testing in CI/CD:</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># .github/workflows/security.yml</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security Testing</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>push</span><span class="p p-Indicator">]</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>  </span><span class=nt>sast</span><span class=p>:</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SonarCloud Scan</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SonarSource/sonarcloud-github-action@master</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>          </span><span class=nt>SONAR_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SONAR_TOKEN }}</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>  </span><span class=nt>iac-scan</span><span class=p>:</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Scan Terraform</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/tfsec-action@v1.0.0</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=w>  </span><span class=nt>container-scan</span><span class=p>:</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build image</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t test-image .</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Scan image</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/trivy-action@master</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>          </span><span class=nt>image-ref</span><span class=p>:</span><span class=w> </span><span class=s>&#39;test-image&#39;</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=w>          </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s>&#39;table&#39;</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=w>          </span><span class=nt>exit-code</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1&#39;</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=w>          </span><span class=nt>ignore-unfixed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=w>          </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=s>&#39;CRITICAL,HIGH&#39;</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=w>  </span><span class=nt>dast</span><span class=p>:</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>build</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>deploy-staging</span><span class="p p-Indicator">]</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ZAP Scan</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">zaproxy/action-baseline@v0.7.0</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=w>          </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=s>&#39;https://staging.example.com/&#39;</span>
</span></code></pre></div></p> <h2 id=cicd-security-maturity-model>CI/CD Security Maturity Model<a class=headerlink href=#cicd-security-maturity-model title="Permanent link">&para;</a></h2> <pre class=mermaid><code>graph TD
    classDef L1 fill:#ffcccb, stroke:#333, stroke-width:1px
    classDef L2 fill:#ffffcc, stroke:#333, stroke-width:1px
    classDef L3 fill:#ccffcc, stroke:#333, stroke-width:1px
    classDef L4 fill:#ccccff, stroke:#333, stroke-width:1px

    L1[Level 1:\nBasic Security]:::L1 --&gt; L2[Level 2:\nStandard Security]:::L2
    L2 --&gt; L3[Level 3:\nAdvanced Security]:::L3
    L3 --&gt; L4[Level 4:\nLeading Practice]:::L4

    L1 --&gt; L1a[Basic Auth\nControls]
    L1 --&gt; L1b[Manual Security\nScans]
    L1 --&gt; L1c[Basic Secret\nManagement]

    L2 --&gt; L2a[RBAC &amp; MFA]
    L2 --&gt; L2b[Automated Security\nTesting in CI/CD]
    L2 --&gt; L2c[Centralized Secret\nManagement]
    L2 --&gt; L2d[Pipeline as Code]

    L3 --&gt; L3a[Ephemeral Build\nEnvironments]
    L3 --&gt; L3b[Code Signing]
    L3 --&gt; L3c[Build Provenance]
    L3 --&gt; L3d[Comprehensive\nMonitoring]

    L4 --&gt; L4a[Hardware Key\nManagement]
    L4 --&gt; L4b[Reproducible\nBuilds]
    L4 --&gt; L4c[Binary\nTransparency]
    L4 --&gt; L4d[Automated Incident\nResponse]</code></pre> <p>The CI/CD Security Maturity Model provides a roadmap for organizations to progressively enhance their pipeline security:</p> <h3 id=level-1-basic-security>Level 1: Basic Security<a class=headerlink href=#level-1-basic-security title="Permanent link">&para;</a></h3> <ul> <li>Basic authentication controls</li> <li>Manual security scans before major releases</li> <li>Simple secret management using environment variables</li> <li>Limited logging and monitoring</li> </ul> <h3 id=level-2-standard-security>Level 2: Standard Security<a class=headerlink href=#level-2-standard-security title="Permanent link">&para;</a></h3> <ul> <li>RBAC implementation with MFA</li> <li>Automated dependency and vulnerability scanning</li> <li>Centralized secret management</li> <li>Pipeline-as-Code with version control</li> <li>Regular security testing</li> </ul> <h3 id=level-3-advanced-security>Level 3: Advanced Security<a class=headerlink href=#level-3-advanced-security title="Permanent link">&para;</a></h3> <ul> <li>Ephemeral, isolated build environments</li> <li>Artifact and container signing</li> <li>Build provenance attestation</li> <li>Comprehensive logging and monitoring</li> <li>Automated policy enforcement</li> </ul> <h3 id=level-4-leading-practice>Level 4: Leading Practice<a class=headerlink href=#level-4-leading-practice title="Permanent link">&para;</a></h3> <ul> <li>Hardware security modules for signing</li> <li>Fully reproducible and verifiable builds</li> <li>Binary transparency for all artifacts</li> <li>Automated detection and response to pipeline anomalies</li> <li>Regular red team testing of CI/CD infrastructure</li> </ul> <h2 id=conclusion-and-recommended-actions>Conclusion and Recommended Actions<a class=headerlink href=#conclusion-and-recommended-actions title="Permanent link">&para;</a></h2> <p>Securing CI/CD pipelines requires a comprehensive approach that addresses people, processes, and technology. Organizations should:</p> <ol> <li><strong>Assess your current state</strong> using the maturity model as a guide</li> <li><strong>Create a roadmap</strong> for implementing missing controls</li> <li><strong>Prioritize high-impact changes</strong> such as access controls and secret management</li> <li><strong>Conduct regular security testing</strong> of the pipeline itself</li> <li><strong>Train developers and operations teams</strong> on secure CI/CD practices</li> </ol> <p>By implementing these controls, organizations can significantly reduce the risk of supply chain attacks originating through their CI/CD pipelines, protecting both their own systems and their customers.</p> <h2 id=pipeline-security-assessment-guide>Pipeline Security Assessment Guide<a class=headerlink href=#pipeline-security-assessment-guide title="Permanent link">&para;</a></h2> <p>Conducting regular security assessments of your CI/CD pipelines is essential for maintaining a secure software supply chain. Use this guide to evaluate your current security posture.</p> <h3 id=assessment-methodology>Assessment Methodology<a class=headerlink href=#assessment-methodology title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart LR
    classDef phase fill:#3498db, stroke:#333, stroke-width:1px, color:white
    classDef activity fill:#2ecc71, stroke:#333, stroke-width:1px

    A[Pipeline Security Assessment]:::phase --&gt; B[Define Scope]:::activity
    B --&gt; C[Document Architecture]:::activity
    C --&gt; D[Identify Assets]:::activity
    D --&gt; E[Identify Threats]:::activity
    E --&gt; F[Test Controls]:::activity
    F --&gt; G[Remediate Gaps]:::activity
    G --&gt; H[Verify Fixes]:::activity</code></pre> <h3 id=cicd-security-audit-checklist>CI/CD Security Audit Checklist<a class=headerlink href=#cicd-security-audit-checklist title="Permanent link">&para;</a></h3> <p>Use this comprehensive checklist to audit your CI/CD pipeline security:</p> <h4 id=access-controls>Access Controls<a class=headerlink href=#access-controls title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Multi-factor authentication enforced for all pipeline system accounts</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Role-based access control implemented with least privilege</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Regular access audits conducted and documented</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Service account permissions limited to required resources</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Temporary elevated access process implemented for maintenance</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Automated offboarding workflow for departing team members</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> IP allowlisting for administrative access</li> </ul> <h4 id=pipeline-configuration>Pipeline Configuration<a class=headerlink href=#pipeline-configuration title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> All pipeline definitions stored as code in version control</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pipeline configuration changes require peer review</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Branch protection rules prevent direct commits to protected branches</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Automated linting/validation of CI/CD configuration files</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pipeline templates use secure defaults</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Regular audits for unexpected pipeline configuration changes</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secrets used in pipelines are rotated regularly</li> </ul> <h4 id=build-environment-security>Build Environment Security<a class=headerlink href=#build-environment-security title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Build environments are ephemeral and destroyed after use</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Each build runs in an isolated environment</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Network access is restricted during builds</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Base images are regularly updated with security patches</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Principle of least privilege applied to build containers</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Read-only file systems used where possible</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Host security controls applied to build servers</li> </ul> <h4 id=secret-management>Secret Management<a class=headerlink href=#secret-management title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> No secrets stored in source code or pipeline definitions</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secrets managed through dedicated secret management service</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secrets accessed through short-lived, just-in-time tokens</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secret access is logged and monitored</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secrets are automatically rotated</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pipeline outputs are scanned for accidentally leaked secrets</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Secret injection happens at runtime, not build time</li> </ul> <h4 id=dependency-security>Dependency Security<a class=headerlink href=#dependency-security title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> All dependencies are scanned for vulnerabilities before use</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Dependency sources are verified (checksums, signatures)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Private artifact repositories used for critical dependencies</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Dependency confusion attacks mitigated via configuration</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Dependency updates trigger security scans</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> SBOMs generated for all builds</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Dependency caching is secure and tampering is detectable</li> </ul> <h4 id=build-integrity>Build Integrity<a class=headerlink href=#build-integrity title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Source code integrity verified before build (signatures)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Reproducible builds implemented where possible</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Build provenance captured and stored securely</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> All artifacts are signed</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Signatures verified before deployment</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Binary transparency logs maintained</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Comparison of artifacts across different build environments</li> </ul> <h4 id=monitoring-and-logging>Monitoring and Logging<a class=headerlink href=#monitoring-and-logging title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Comprehensive logging of all pipeline activities</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pipeline logs are immutable and securely stored</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Anomaly detection implemented for build patterns</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Alerts configured for security-relevant events</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Build time monitoring for unexpected deviations</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Resource utilization monitored for abnormal patterns</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Log correlation across pipeline stages</li> </ul> <h4 id=incident-response>Incident Response<a class=headerlink href=#incident-response title="Permanent link">&para;</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Incident response plan specific to CI/CD compromise</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pipeline-specific playbooks for common scenarios</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Regular tabletop exercises for pipeline security incidents</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Capabilities to revoke compromised artifacts</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Process to rapidly patch compromised systems</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Communication plan for supply chain security incidents</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Post-incident review process</li> </ul> <h2 id=pipeline-security-architecture-patterns>Pipeline Security Architecture Patterns<a class=headerlink href=#pipeline-security-architecture-patterns title="Permanent link">&para;</a></h2> <h3 id=pattern-1-defense-in-depth-pipeline-architecture>Pattern 1: Defense in Depth Pipeline Architecture<a class=headerlink href=#pattern-1-defense-in-depth-pipeline-architecture title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart TD
    classDef zone1 fill:#cfe2f3, stroke:#333, stroke-width:1px
    classDef zone2 fill:#d9ead3, stroke:#333, stroke-width:1px
    classDef zone3 fill:#fff2cc, stroke:#333, stroke-width:1px
    classDef zone4 fill:#f4cccc, stroke:#333, stroke-width:1px

    subgraph "Zone 1: Source Control"
        A[Git Repository] --&gt;|Code Changes| B[PR Validation]
        B --&gt;|Approved Changes| C[Protected Branch]
    end

    subgraph "Zone 2: Build Triggering"
        D[Webhook Receiver] --&gt;|Validated Event| E[Build Orchestrator]
        E --&gt;|Job Assignment| F[Build Agent Pool]
    end

    subgraph "Zone 3: Build Execution"
        G[Ephemeral Build Container] --&gt;|Execute Steps| H[Artifact Creation]
        I[Dependency Cache] --&gt;|Verified Deps| G
        J[Secrets Service] --&gt;|Temp Credentials| G
    end

    subgraph "Zone 4: Artifact Management"
        K[Artifact Repository] --&gt;|Promotion| L[Staging Repository]
        L --&gt;|Verified &amp; Approved| M[Production Repository]
    end

    C --&gt;|Trigger| D
    F --&gt;|Provision| G
    H --&gt;|Store| K

    classDef zone1 zone1
    classDef zone2 zone2
    classDef zone3 zone3
    classDef zone4 zone4</code></pre> <p><strong>Security Controls by Zone:</strong></p> <p><strong>Zone 1: Source Control</strong> - Signed commits - Multi-factor authentication - Branch protection rules - Required code reviews - Status checks</p> <p><strong>Zone 2: Build Triggering</strong> - Event validation - Rate limiting - IP allowlisting - Webhook secrets</p> <p><strong>Zone 3: Build Execution</strong> - Ephemeral environments - Container security scanning - Runtime isolation - Just-in-time credentials - Dependency verification</p> <p><strong>Zone 4: Artifact Management</strong> - Artifact signing - Security scanning - Signature verification - SBOM validation - Promotion approvals</p> <h3 id=pattern-2-secure-multi-environment-pipeline>Pattern 2: Secure Multi-Environment Pipeline<a class=headerlink href=#pattern-2-secure-multi-environment-pipeline title="Permanent link">&para;</a></h3> <pre class=mermaid><code>sequenceDiagram
    participant Dev as Developer
    participant SCM as Source Control
    participant CI as CI System
    participant Sec as Security Gates
    participant Reg as Registry
    participant Test as Test Environment
    participant Prod as Production

    Dev-&gt;&gt;SCM: Commit Code
    SCM-&gt;&gt;CI: Trigger Pipeline

    CI-&gt;&gt;Sec: Security Scan #1&lt;br&gt;(SAST, SCA)
    Sec-&gt;&gt;CI: Pass/Fail

    CI-&gt;&gt;Reg: Build &amp; Push&lt;br&gt;Development Artifact

    CI-&gt;&gt;Test: Deploy to Test

    CI-&gt;&gt;Sec: Security Scan #2&lt;br&gt;(DAST, IAST)
    Sec-&gt;&gt;CI: Pass/Fail

    CI-&gt;&gt;Reg: Promote &amp; Sign&lt;br&gt;Release Candidate

    CI-&gt;&gt;Sec: Final Security Review
    Sec-&gt;&gt;CI: Approval

    CI-&gt;&gt;Prod: Controlled Deployment

    Note over CI,Sec: Security gates prevent&lt;br&gt;progression if issues found</code></pre> <h2 id=practical-implementation-guide>Practical Implementation Guide<a class=headerlink href=#practical-implementation-guide title="Permanent link">&para;</a></h2> <h3 id=implementing-pipeline-security-in-github-actions>Implementing Pipeline Security in GitHub Actions<a class=headerlink href=#implementing-pipeline-security-in-github-actions title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># .github/workflows/secure-pipeline.yml</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secure CI/CD Pipeline</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=nv>main</span><span class=w> </span><span class="p p-Indicator">]</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span><span class=c1># SECURITY GATE 1: Source Validation</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span><span class=nt>validate-source</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>    </span><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>      </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Verify commit signatures</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>          </span><span class=no>git verify-commit HEAD</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Lint code</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github/super-linter@v4</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=w>          </span><span class=nt>VALIDATE_ALL_CODEBASE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a><span class=w>          </span><span class=nt>GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a><span class=w>  </span><span class=c1># SECURITY GATE 2: Dependency Security</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a><span class=w>  </span><span class=nt>dependency-check</span><span class=p>:</span>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validate-source</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a><span class=w>    </span><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a><span class=w>      </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">18</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a><span class=w>          </span><span class=nt>registry-url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://registry.npmjs.org/</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check for vulnerable dependencies</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm audit --audit-level=high</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Generate SBOM</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cyclonedx/gh-node-module-generatebom@master</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a><span class=w>          </span><span class=nt>output</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sbom.xml</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59 href=#__codelineno-9-59></a>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60 href=#__codelineno-9-60></a><span class=w>  </span><span class=c1># SECURITY GATE 3: SAST and Secret Scanning</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61 href=#__codelineno-9-61></a><span class=w>  </span><span class=nt>security-scans</span><span class=p>:</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62 href=#__codelineno-9-62></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dependency-check</span>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63 href=#__codelineno-9-63></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64 href=#__codelineno-9-64></a><span class=w>    </span><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65 href=#__codelineno-9-65></a><span class=w>      </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66 href=#__codelineno-9-66></a><span class=w>      </span><span class=nt>security-events</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67 href=#__codelineno-9-67></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-9-68><a id=__codelineno-9-68 name=__codelineno-9-68 href=#__codelineno-9-68></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
</span><span id=__span-9-69><a id=__codelineno-9-69 name=__codelineno-9-69 href=#__codelineno-9-69></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-9-70><a id=__codelineno-9-70 name=__codelineno-9-70 href=#__codelineno-9-70></a>
</span><span id=__span-9-71><a id=__codelineno-9-71 name=__codelineno-9-71 href=#__codelineno-9-71></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CodeQL Analysis</span>
</span><span id=__span-9-72><a id=__codelineno-9-72 name=__codelineno-9-72 href=#__codelineno-9-72></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/analyze@v2</span>
</span><span id=__span-9-73><a id=__codelineno-9-73 name=__codelineno-9-73 href=#__codelineno-9-73></a>
</span><span id=__span-9-74><a id=__codelineno-9-74 name=__codelineno-9-74 href=#__codelineno-9-74></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret scanning</span>
</span><span id=__span-9-75><a id=__codelineno-9-75 name=__codelineno-9-75 href=#__codelineno-9-75></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gitleaks/gitleaks-action@v2</span>
</span><span id=__span-9-76><a id=__codelineno-9-76 name=__codelineno-9-76 href=#__codelineno-9-76></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-9-77><a id=__codelineno-9-77 name=__codelineno-9-77 href=#__codelineno-9-77></a><span class=w>          </span><span class=nt>GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id=__span-9-78><a id=__codelineno-9-78 name=__codelineno-9-78 href=#__codelineno-9-78></a>
</span><span id=__span-9-79><a id=__codelineno-9-79 name=__codelineno-9-79 href=#__codelineno-9-79></a><span class=w>  </span><span class=c1># SECURITY GATE 4: Secure Build</span>
</span><span id=__span-9-80><a id=__codelineno-9-80 name=__codelineno-9-80 href=#__codelineno-9-80></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-9-81><a id=__codelineno-9-81 name=__codelineno-9-81 href=#__codelineno-9-81></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">security-scans</span>
</span><span id=__span-9-82><a id=__codelineno-9-82 name=__codelineno-9-82 href=#__codelineno-9-82></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-9-83><a id=__codelineno-9-83 name=__codelineno-9-83 href=#__codelineno-9-83></a><span class=w>    </span><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-9-84><a id=__codelineno-9-84 name=__codelineno-9-84 href=#__codelineno-9-84></a><span class=w>      </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id=__span-9-85><a id=__codelineno-9-85 name=__codelineno-9-85 href=#__codelineno-9-85></a><span class=w>      </span><span class=nt>packages</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id=__span-9-86><a id=__codelineno-9-86 name=__codelineno-9-86 href=#__codelineno-9-86></a><span class=w>      </span><span class=nt>id-token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write</span><span class=w> </span><span class=c1># For OIDC signing</span>
</span><span id=__span-9-87><a id=__codelineno-9-87 name=__codelineno-9-87 href=#__codelineno-9-87></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-9-88><a id=__codelineno-9-88 name=__codelineno-9-88 href=#__codelineno-9-88></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Checkout code</span>
</span><span id=__span-9-89><a id=__codelineno-9-89 name=__codelineno-9-89 href=#__codelineno-9-89></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-9-90><a id=__codelineno-9-90 name=__codelineno-9-90 href=#__codelineno-9-90></a>
</span><span id=__span-9-91><a id=__codelineno-9-91 name=__codelineno-9-91 href=#__codelineno-9-91></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
</span><span id=__span-9-92><a id=__codelineno-9-92 name=__codelineno-9-92 href=#__codelineno-9-92></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span>
</span><span id=__span-9-93><a id=__codelineno-9-93 name=__codelineno-9-93 href=#__codelineno-9-93></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-9-94><a id=__codelineno-9-94 name=__codelineno-9-94 href=#__codelineno-9-94></a><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">18</span>
</span><span id=__span-9-95><a id=__codelineno-9-95 name=__codelineno-9-95 href=#__codelineno-9-95></a>
</span><span id=__span-9-96><a id=__codelineno-9-96 name=__codelineno-9-96 href=#__codelineno-9-96></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build application</span>
</span><span id=__span-9-97><a id=__codelineno-9-97 name=__codelineno-9-97 href=#__codelineno-9-97></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-9-98><a id=__codelineno-9-98 name=__codelineno-9-98 href=#__codelineno-9-98></a><span class=w>          </span><span class=no>npm ci</span>
</span><span id=__span-9-99><a id=__codelineno-9-99 name=__codelineno-9-99 href=#__codelineno-9-99></a><span class=w>          </span><span class=no>npm run build</span>
</span><span id=__span-9-100><a id=__codelineno-9-100 name=__codelineno-9-100 href=#__codelineno-9-100></a>
</span><span id=__span-9-101><a id=__codelineno-9-101 name=__codelineno-9-101 href=#__codelineno-9-101></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Sign artifacts</span>
</span><span id=__span-9-102><a id=__codelineno-9-102 name=__codelineno-9-102 href=#__codelineno-9-102></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sigstore/cosign-installer@main</span>
</span><span id=__span-9-103><a id=__codelineno-9-103 name=__codelineno-9-103 href=#__codelineno-9-103></a>
</span><span id=__span-9-104><a id=__codelineno-9-104 name=__codelineno-9-104 href=#__codelineno-9-104></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build and push container</span>
</span><span id=__span-9-105><a id=__codelineno-9-105 name=__codelineno-9-105 href=#__codelineno-9-105></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v4</span>
</span><span id=__span-9-106><a id=__codelineno-9-106 name=__codelineno-9-106 href=#__codelineno-9-106></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-9-107><a id=__codelineno-9-107 name=__codelineno-9-107 href=#__codelineno-9-107></a><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-9-108><a id=__codelineno-9-108 name=__codelineno-9-108 href=#__codelineno-9-108></a><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-9-109><a id=__codelineno-9-109 name=__codelineno-9-109 href=#__codelineno-9-109></a><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/myorg/myapp:${{ github.sha }}</span>
</span><span id=__span-9-110><a id=__codelineno-9-110 name=__codelineno-9-110 href=#__codelineno-9-110></a>
</span><span id=__span-9-111><a id=__codelineno-9-111 name=__codelineno-9-111 href=#__codelineno-9-111></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Sign container with keyless signing</span>
</span><span id=__span-9-112><a id=__codelineno-9-112 name=__codelineno-9-112 href=#__codelineno-9-112></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-9-113><a id=__codelineno-9-113 name=__codelineno-9-113 href=#__codelineno-9-113></a><span class=w>          </span><span class=no>cosign sign ghcr.io/myorg/myapp:${{ github.sha }}</span>
</span><span id=__span-9-114><a id=__codelineno-9-114 name=__codelineno-9-114 href=#__codelineno-9-114></a>
</span><span id=__span-9-115><a id=__codelineno-9-115 name=__codelineno-9-115 href=#__codelineno-9-115></a><span class=w>  </span><span class=c1># SECURITY GATE 5: Deployment Security</span>
</span><span id=__span-9-116><a id=__codelineno-9-116 name=__codelineno-9-116 href=#__codelineno-9-116></a><span class=w>  </span><span class=nt>deploy-staging</span><span class=p>:</span>
</span><span id=__span-9-117><a id=__codelineno-9-117 name=__codelineno-9-117 href=#__codelineno-9-117></a><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id=__span-9-118><a id=__codelineno-9-118 name=__codelineno-9-118 href=#__codelineno-9-118></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-9-119><a id=__codelineno-9-119 name=__codelineno-9-119 href=#__codelineno-9-119></a><span class=w>    </span><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-9-120><a id=__codelineno-9-120 name=__codelineno-9-120 href=#__codelineno-9-120></a><span class=w>      </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id=__span-9-121><a id=__codelineno-9-121 name=__codelineno-9-121 href=#__codelineno-9-121></a><span class=w>      </span><span class=nt>id-token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id=__span-9-122><a id=__codelineno-9-122 name=__codelineno-9-122 href=#__codelineno-9-122></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</span><span id=__span-9-123><a id=__codelineno-9-123 name=__codelineno-9-123 href=#__codelineno-9-123></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-9-124><a id=__codelineno-9-124 name=__codelineno-9-124 href=#__codelineno-9-124></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Verify artifact signature</span>
</span><span id=__span-9-125><a id=__codelineno-9-125 name=__codelineno-9-125 href=#__codelineno-9-125></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sigstore/cosign-installer@main</span>
</span><span id=__span-9-126><a id=__codelineno-9-126 name=__codelineno-9-126 href=#__codelineno-9-126></a>
</span><span id=__span-9-127><a id=__codelineno-9-127 name=__codelineno-9-127 href=#__codelineno-9-127></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Verify signature</span>
</span><span id=__span-9-128><a id=__codelineno-9-128 name=__codelineno-9-128 href=#__codelineno-9-128></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-9-129><a id=__codelineno-9-129 name=__codelineno-9-129 href=#__codelineno-9-129></a><span class=w>          </span><span class=no>cosign verify ghcr.io/myorg/myapp:${{ github.sha }}</span>
</span><span id=__span-9-130><a id=__codelineno-9-130 name=__codelineno-9-130 href=#__codelineno-9-130></a>
</span><span id=__span-9-131><a id=__codelineno-9-131 name=__codelineno-9-131 href=#__codelineno-9-131></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to staging</span>
</span><span id=__span-9-132><a id=__codelineno-9-132 name=__codelineno-9-132 href=#__codelineno-9-132></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-9-133><a id=__codelineno-9-133 name=__codelineno-9-133 href=#__codelineno-9-133></a><span class=w>          </span><span class=no># Deployment script with signature validation</span>
</span></code></pre></div> <h3 id=implementing-pipeline-security-in-gitlab-ci>Implementing Pipeline Security in GitLab CI<a class=headerlink href=#implementing-pipeline-security-in-gitlab-ci title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># .gitlab-ci.yml</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=nt>stages</span><span class=p>:</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">scan</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sign</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=nt>variables</span><span class=p>:</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=nt>SECURE_ANALYZERS_PREFIX</span><span class=p>:</span><span class=w> </span><span class=s>&quot;registry.gitlab.com/security-products&quot;</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>  </span><span class=nt>SECURE_CI_OPT_FLAGS</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=c1># Stage: Validate</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=nt>validate-pipeline</span><span class=p>:</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ci-lint .gitlab-ci.yml</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=c1># Security Scans</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/SAST.gitlab-ci.yml</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/Dependency-Scanning.gitlab-ci.yml</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/Secret-Detection.gitlab-ci.yml</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>template</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security/Container-Scanning.gitlab-ci.yml</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=c1># Build with provenance</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker:20.10.16</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>  </span><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker:20.10.16-dind</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>  </span><span class=nt>variables</span><span class=p>:</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>    </span><span class=nt>DOCKER_TLS_CERTDIR</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/certs&quot;</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;${CI_REGISTRY_PASSWORD}&quot; | docker login -u &quot;${CI_REGISTRY_USER}&quot; --password-stdin $CI_REGISTRY</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=w>    </span><span class=c1># Generate provenance data</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=w>      </span><span class=no>cat &gt; provenance.json &lt;&lt;EOF</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=w>      </span><span class=no>{</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a><span class=w>        </span><span class=no>&quot;buildType&quot;: &quot;gitlab-ci&quot;,</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=w>        </span><span class=no>&quot;builder&quot;: {</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a><span class=w>          </span><span class=no>&quot;id&quot;: &quot;${CI_SERVER_URL}/${CI_PROJECT_PATH}/-/pipelines/${CI_PIPELINE_ID}&quot;</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a><span class=w>        </span><span class=no>},</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a><span class=w>        </span><span class=no>&quot;recipe&quot;: {</span>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a><span class=w>          </span><span class=no>&quot;type&quot;: &quot;Dockerfile&quot;,</span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a><span class=w>          </span><span class=no>&quot;uri&quot;: &quot;git+${CI_REPOSITORY_URL}@${CI_COMMIT_SHA}&quot;</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a><span class=w>        </span><span class=no>},</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a><span class=w>        </span><span class=no>&quot;metadata&quot;: {</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a><span class=w>          </span><span class=no>&quot;buildInvocationId&quot;: &quot;${CI_PIPELINE_ID}&quot;,</span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a><span class=w>          </span><span class=no>&quot;buildStartedOn&quot;: &quot;$(date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;)&quot;</span>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a><span class=w>        </span><span class=no>}</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a><span class=w>      </span><span class=no>}</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a><span class=w>      </span><span class=no>EOF</span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58 href=#__codelineno-10-58></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cat provenance.json | base64 &gt; provenance.b64</span>
</span><span id=__span-10-59><a id=__codelineno-10-59 name=__codelineno-10-59 href=#__codelineno-10-59></a><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span>
</span><span id=__span-10-60><a id=__codelineno-10-60 name=__codelineno-10-60 href=#__codelineno-10-60></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-10-61><a id=__codelineno-10-61 name=__codelineno-10-61 href=#__codelineno-10-61></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">provenance.b64</span>
</span><span id=__span-10-62><a id=__codelineno-10-62 name=__codelineno-10-62 href=#__codelineno-10-62></a>
</span><span id=__span-10-63><a id=__codelineno-10-63 name=__codelineno-10-63 href=#__codelineno-10-63></a><span class=c1># Sign artifacts</span>
</span><span id=__span-10-64><a id=__codelineno-10-64 name=__codelineno-10-64 href=#__codelineno-10-64></a><span class=nt>sign-artifacts</span><span class=p>:</span>
</span><span id=__span-10-65><a id=__codelineno-10-65 name=__codelineno-10-65 href=#__codelineno-10-65></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sign</span>
</span><span id=__span-10-66><a id=__codelineno-10-66 name=__codelineno-10-66 href=#__codelineno-10-66></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-10-67><a id=__codelineno-10-67 name=__codelineno-10-67 href=#__codelineno-10-67></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-10-68><a id=__codelineno-10-68 name=__codelineno-10-68 href=#__codelineno-10-68></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apk add --no-cache cosign</span>
</span><span id=__span-10-69><a id=__codelineno-10-69 name=__codelineno-10-69 href=#__codelineno-10-69></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cosign sign --key ${COSIGN_KEY_PATH} $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA</span>
</span><span id=__span-10-70><a id=__codelineno-10-70 name=__codelineno-10-70 href=#__codelineno-10-70></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cosign attach attestation --key ${COSIGN_KEY_PATH} --type provenance $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA --attestation provenance.b64</span>
</span><span id=__span-10-71><a id=__codelineno-10-71 name=__codelineno-10-71 href=#__codelineno-10-71></a><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span>
</span><span id=__span-10-72><a id=__codelineno-10-72 name=__codelineno-10-72 href=#__codelineno-10-72></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
</span><span id=__span-10-73><a id=__codelineno-10-73 name=__codelineno-10-73 href=#__codelineno-10-73></a>
</span><span id=__span-10-74><a id=__codelineno-10-74 name=__codelineno-10-74 href=#__codelineno-10-74></a><span class=c1># Deploy with verification</span>
</span><span id=__span-10-75><a id=__codelineno-10-75 name=__codelineno-10-75 href=#__codelineno-10-75></a><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-10-76><a id=__codelineno-10-76 name=__codelineno-10-76 href=#__codelineno-10-76></a><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id=__span-10-77><a id=__codelineno-10-77 name=__codelineno-10-77 href=#__codelineno-10-77></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-10-78><a id=__codelineno-10-78 name=__codelineno-10-78 href=#__codelineno-10-78></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-10-79><a id=__codelineno-10-79 name=__codelineno-10-79 href=#__codelineno-10-79></a><span class=w>  </span><span class=nt>script</span><span class=p>:</span>
</span><span id=__span-10-80><a id=__codelineno-10-80 name=__codelineno-10-80 href=#__codelineno-10-80></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apk add --no-cache cosign</span>
</span><span id=__span-10-81><a id=__codelineno-10-81 name=__codelineno-10-81 href=#__codelineno-10-81></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cosign verify --key ${COSIGN_PUB_KEY_PATH} $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA</span>
</span><span id=__span-10-82><a id=__codelineno-10-82 name=__codelineno-10-82 href=#__codelineno-10-82></a><span class=w>    </span><span class=c1># Deploy only if signature is valid</span>
</span><span id=__span-10-83><a id=__codelineno-10-83 name=__codelineno-10-83 href=#__codelineno-10-83></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Deploying verified container...&quot;</span>
</span><span id=__span-10-84><a id=__codelineno-10-84 name=__codelineno-10-84 href=#__codelineno-10-84></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
</span><span id=__span-10-85><a id=__codelineno-10-85 name=__codelineno-10-85 href=#__codelineno-10-85></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$CI_COMMIT_BRANCH == &quot;main&quot;</span>
</span></code></pre></div> <h3 id=implementing-pipeline-security-in-azure-devops>Implementing Pipeline Security in Azure DevOps<a class=headerlink href=#implementing-pipeline-security-in-azure-devops title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># azure-pipelines.yml</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=nt>trigger</span><span class=p>:</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=nt>pool</span><span class=p>:</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=nt>vmImage</span><span class=p>:</span><span class=w> </span><span class=s>&#39;ubuntu-latest&#39;</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=nt>stages</span><span class=p>:</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SecureValidation</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>  </span><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ValidateSource</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>checkout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">self</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>      </span><span class=nt>persistCredentials</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>      </span><span class=nt>fetchDepth</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>        </span><span class=no># Verify GPG signatures if configured</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>        </span><span class=no>git verify-commit HEAD || echo &quot;Commit signature verification not configured&quot;</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Verify</span><span class=nv> </span><span class=s>commit</span><span class=nv> </span><span class=s>signatures&#39;</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>task</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WhiteSource@21</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Scan</span><span class=nv> </span><span class=s>dependencies&#39;</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>        </span><span class=nt>cwd</span><span class=p>:</span><span class=w> </span><span class=s>&#39;$(System.DefaultWorkingDirectory)&#39;</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SecureBuild</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>  </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SecureValidation</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=w>  </span><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">BuildWithProvenance</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>task</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Docker@2</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Build</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>Push&#39;</span>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">buildAndPush</span>
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=w>        </span><span class=nt>containerRegistry</span><span class=p>:</span><span class=w> </span><span class=s>&#39;myregistry&#39;</span>
</span><span id=__span-11-37><a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>        </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=s>&#39;myapp&#39;</span>
</span><span id=__span-11-38><a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a><span class=w>        </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=s>&#39;$(Build.BuildId)&#39;</span>
</span><span id=__span-11-39><a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a>
</span><span id=__span-11-40><a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-11-41><a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=w>        </span><span class=no># Generate provenance data</span>
</span><span id=__span-11-42><a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a><span class=w>        </span><span class=no>cat &gt; provenance.json &lt;&lt;EOF</span>
</span><span id=__span-11-43><a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=w>        </span><span class=no>{</span>
</span><span id=__span-11-44><a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a><span class=w>          </span><span class=no>&quot;buildType&quot;: &quot;azure-devops&quot;,</span>
</span><span id=__span-11-45><a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a><span class=w>          </span><span class=no>&quot;builder&quot;: {</span>
</span><span id=__span-11-46><a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a><span class=w>            </span><span class=no>&quot;id&quot;: &quot;$(System.TeamFoundationCollectionUri)/$(System.TeamProject)/_build/results?buildId=$(Build.BuildId)&quot;</span>
</span><span id=__span-11-47><a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a><span class=w>          </span><span class=no>},</span>
</span><span id=__span-11-48><a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a><span class=w>          </span><span class=no>&quot;recipe&quot;: {</span>
</span><span id=__span-11-49><a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=w>            </span><span class=no>&quot;type&quot;: &quot;Dockerfile&quot;,</span>
</span><span id=__span-11-50><a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a><span class=w>            </span><span class=no>&quot;uri&quot;: &quot;git+$(Build.Repository.Uri)@$(Build.SourceVersion)&quot;</span>
</span><span id=__span-11-51><a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a><span class=w>          </span><span class=no>},</span>
</span><span id=__span-11-52><a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a><span class=w>          </span><span class=no>&quot;metadata&quot;: {</span>
</span><span id=__span-11-53><a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a><span class=w>            </span><span class=no>&quot;buildInvocationId&quot;: &quot;$(Build.BuildId)&quot;,</span>
</span><span id=__span-11-54><a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a><span class=w>            </span><span class=no>&quot;buildStartedOn&quot;: &quot;$(Build.QueuedOn)&quot;</span>
</span><span id=__span-11-55><a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a><span class=w>          </span><span class=no>}</span>
</span><span id=__span-11-56><a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a><span class=w>        </span><span class=no>}</span>
</span><span id=__span-11-57><a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a><span class=w>        </span><span class=no>EOF</span>
</span><span id=__span-11-58><a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Generate</span><span class=nv> </span><span class=s>build</span><span class=nv> </span><span class=s>provenance&#39;</span>
</span><span id=__span-11-59><a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a>
</span><span id=__span-11-60><a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>task</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyVault@2</span>
</span><span id=__span-11-61><a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Get</span><span class=nv> </span><span class=s>signing</span><span class=nv> </span><span class=s>key</span><span class=nv> </span><span class=s>from</span><span class=nv> </span><span class=s>vault&#39;</span>
</span><span id=__span-11-62><a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-11-63><a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a><span class=w>        </span><span class=nt>azureSubscription</span><span class=p>:</span><span class=w> </span><span class=s>&#39;my-subscription&#39;</span>
</span><span id=__span-11-64><a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a><span class=w>        </span><span class=nt>KeyVaultName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;my-keyvault&#39;</span>
</span><span id=__span-11-65><a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a><span class=w>        </span><span class=nt>SecretsFilter</span><span class=p>:</span><span class=w> </span><span class=s>&#39;signing-key&#39;</span>
</span><span id=__span-11-66><a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a>
</span><span id=__span-11-67><a id=__codelineno-11-67 name=__codelineno-11-67 href=#__codelineno-11-67></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-11-68><a id=__codelineno-11-68 name=__codelineno-11-68 href=#__codelineno-11-68></a><span class=w>        </span><span class=no># Install Cosign</span>
</span><span id=__span-11-69><a id=__codelineno-11-69 name=__codelineno-11-69 href=#__codelineno-11-69></a><span class=w>        </span><span class=no>curl -LO https://github.com/sigstore/cosign/releases/download/v1.13.0/cosign-linux-amd64</span>
</span><span id=__span-11-70><a id=__codelineno-11-70 name=__codelineno-11-70 href=#__codelineno-11-70></a><span class=w>        </span><span class=no>chmod +x cosign-linux-amd64</span>
</span><span id=__span-11-71><a id=__codelineno-11-71 name=__codelineno-11-71 href=#__codelineno-11-71></a><span class=w>        </span><span class=no>mv cosign-linux-amd64 /usr/local/bin/cosign</span>
</span><span id=__span-11-72><a id=__codelineno-11-72 name=__codelineno-11-72 href=#__codelineno-11-72></a>
</span><span id=__span-11-73><a id=__codelineno-11-73 name=__codelineno-11-73 href=#__codelineno-11-73></a><span class=w>        </span><span class=no># Sign the container</span>
</span><span id=__span-11-74><a id=__codelineno-11-74 name=__codelineno-11-74 href=#__codelineno-11-74></a><span class=w>        </span><span class=no>echo &quot;$(signing-key)&quot; &gt; cosign.key</span>
</span><span id=__span-11-75><a id=__codelineno-11-75 name=__codelineno-11-75 href=#__codelineno-11-75></a><span class=w>        </span><span class=no>COSIGN_PASSWORD=&quot;&quot; cosign sign --key cosign.key myregistry.azurecr.io/myapp:$(Build.BuildId)</span>
</span><span id=__span-11-76><a id=__codelineno-11-76 name=__codelineno-11-76 href=#__codelineno-11-76></a>
</span><span id=__span-11-77><a id=__codelineno-11-77 name=__codelineno-11-77 href=#__codelineno-11-77></a><span class=w>        </span><span class=no># Clean up</span>
</span><span id=__span-11-78><a id=__codelineno-11-78 name=__codelineno-11-78 href=#__codelineno-11-78></a><span class=w>        </span><span class=no>rm -f cosign.key</span>
</span><span id=__span-11-79><a id=__codelineno-11-79 name=__codelineno-11-79 href=#__codelineno-11-79></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Sign</span><span class=nv> </span><span class=s>container</span><span class=nv> </span><span class=s>image&#39;</span>
</span><span id=__span-11-80><a id=__codelineno-11-80 name=__codelineno-11-80 href=#__codelineno-11-80></a>
</span><span id=__span-11-81><a id=__codelineno-11-81 name=__codelineno-11-81 href=#__codelineno-11-81></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SecureDeployment</span>
</span><span id=__span-11-82><a id=__codelineno-11-82 name=__codelineno-11-82 href=#__codelineno-11-82></a><span class=w>  </span><span class=nt>dependsOn</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">SecureBuild</span>
</span><span id=__span-11-83><a id=__codelineno-11-83 name=__codelineno-11-83 href=#__codelineno-11-83></a><span class=w>  </span><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-11-84><a id=__codelineno-11-84 name=__codelineno-11-84 href=#__codelineno-11-84></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VerifyAndDeploy</span>
</span><span id=__span-11-85><a id=__codelineno-11-85 name=__codelineno-11-85 href=#__codelineno-11-85></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-11-86><a id=__codelineno-11-86 name=__codelineno-11-86 href=#__codelineno-11-86></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>task</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AzureKeyVault@2</span>
</span><span id=__span-11-87><a id=__codelineno-11-87 name=__codelineno-11-87 href=#__codelineno-11-87></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Get</span><span class=nv> </span><span class=s>verification</span><span class=nv> </span><span class=s>key&#39;</span>
</span><span id=__span-11-88><a id=__codelineno-11-88 name=__codelineno-11-88 href=#__codelineno-11-88></a><span class=w>      </span><span class=nt>inputs</span><span class=p>:</span>
</span><span id=__span-11-89><a id=__codelineno-11-89 name=__codelineno-11-89 href=#__codelineno-11-89></a><span class=w>        </span><span class=nt>azureSubscription</span><span class=p>:</span><span class=w> </span><span class=s>&#39;my-subscription&#39;</span>
</span><span id=__span-11-90><a id=__codelineno-11-90 name=__codelineno-11-90 href=#__codelineno-11-90></a><span class=w>        </span><span class=nt>KeyVaultName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;my-keyvault&#39;</span>
</span><span id=__span-11-91><a id=__codelineno-11-91 name=__codelineno-11-91 href=#__codelineno-11-91></a><span class=w>        </span><span class=nt>SecretsFilter</span><span class=p>:</span><span class=w> </span><span class=s>&#39;verification-key&#39;</span>
</span><span id=__span-11-92><a id=__codelineno-11-92 name=__codelineno-11-92 href=#__codelineno-11-92></a>
</span><span id=__span-11-93><a id=__codelineno-11-93 name=__codelineno-11-93 href=#__codelineno-11-93></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-11-94><a id=__codelineno-11-94 name=__codelineno-11-94 href=#__codelineno-11-94></a><span class=w>        </span><span class=no># Install Cosign</span>
</span><span id=__span-11-95><a id=__codelineno-11-95 name=__codelineno-11-95 href=#__codelineno-11-95></a><span class=w>        </span><span class=no>curl -LO https://github.com/sigstore/cosign/releases/download/v1.13.0/cosign-linux-amd64</span>
</span><span id=__span-11-96><a id=__codelineno-11-96 name=__codelineno-11-96 href=#__codelineno-11-96></a><span class=w>        </span><span class=no>chmod +x cosign-linux-amd64</span>
</span><span id=__span-11-97><a id=__codelineno-11-97 name=__codelineno-11-97 href=#__codelineno-11-97></a><span class=w>        </span><span class=no>mv cosign-linux-amd64 /usr/local/bin/cosign</span>
</span><span id=__span-11-98><a id=__codelineno-11-98 name=__codelineno-11-98 href=#__codelineno-11-98></a>
</span><span id=__span-11-99><a id=__codelineno-11-99 name=__codelineno-11-99 href=#__codelineno-11-99></a><span class=w>        </span><span class=no># Verify signature</span>
</span><span id=__span-11-100><a id=__codelineno-11-100 name=__codelineno-11-100 href=#__codelineno-11-100></a><span class=w>        </span><span class=no>echo &quot;$(verification-key)&quot; &gt; cosign.pub</span>
</span><span id=__span-11-101><a id=__codelineno-11-101 name=__codelineno-11-101 href=#__codelineno-11-101></a><span class=w>        </span><span class=no>cosign verify --key cosign.pub myregistry.azurecr.io/myapp:$(Build.BuildId)</span>
</span><span id=__span-11-102><a id=__codelineno-11-102 name=__codelineno-11-102 href=#__codelineno-11-102></a>
</span><span id=__span-11-103><a id=__codelineno-11-103 name=__codelineno-11-103 href=#__codelineno-11-103></a><span class=w>        </span><span class=no># Deploy if verification succeeds</span>
</span><span id=__span-11-104><a id=__codelineno-11-104 name=__codelineno-11-104 href=#__codelineno-11-104></a><span class=w>        </span><span class=no>echo &quot;Deploying verified container...&quot;</span>
</span><span id=__span-11-105><a id=__codelineno-11-105 name=__codelineno-11-105 href=#__codelineno-11-105></a>
</span><span id=__span-11-106><a id=__codelineno-11-106 name=__codelineno-11-106 href=#__codelineno-11-106></a><span class=w>        </span><span class=no># Clean up</span>
</span><span id=__span-11-107><a id=__codelineno-11-107 name=__codelineno-11-107 href=#__codelineno-11-107></a><span class=w>        </span><span class=no>rm -f cosign.pub</span>
</span><span id=__span-11-108><a id=__codelineno-11-108 name=__codelineno-11-108 href=#__codelineno-11-108></a><span class=w>      </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s>&#39;Verify</span><span class=nv> </span><span class=s>signature</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>deploy&#39;</span>
</span></code></pre></div> <h2 id=advanced-pipeline-security-techniques>Advanced Pipeline Security Techniques<a class=headerlink href=#advanced-pipeline-security-techniques title="Permanent link">&para;</a></h2> <h3 id=binary-authorization-and-policy-enforcement>Binary Authorization and Policy Enforcement<a class=headerlink href=#binary-authorization-and-policy-enforcement title="Permanent link">&para;</a></h3> <p>Binary authorization enforces deployment-time security policies based on container images:</p> <pre class=mermaid><code>flowchart LR
    classDef primary fill:#3498db, stroke:#333, stroke-width:1px, color:white
    classDef secondary fill:#2ecc71, stroke:#333, stroke-width:1px
    classDef blocked fill:#e74c3c, stroke:#333, stroke-width:1px, color:white
    classDef passed fill:#2ecc71, stroke:#333, stroke-width:1px

    A[Artifact Repository]:::primary --&gt; B[Binary Authorization]:::primary
    B --&gt; C{Policy Check}:::primary

    D[Required Signatures]:::secondary --&gt; C
    E[Vulnerability Thresholds]:::secondary --&gt; C
    F[Build Provenance]:::secondary --&gt; C
    G[SBOM Requirements]:::secondary --&gt; C

    C --&gt;|Reject| H[Deployment Blocked]:::blocked
    C --&gt;|Accept| I[Deployment Allowed]:::passed</code></pre> <p>Key aspects of binary authorization:</p> <ol> <li><strong>Policy Definition</strong>: Define which attestations are required for deployment</li> <li><strong>Attestation Creation</strong>: Generate signed attestations during the build process</li> <li><strong>Policy Enforcement</strong>: Verify attestations before deployment</li> <li><strong>Break Glass Procedures</strong>: Define exception processes for emergencies</li> </ol> <h3 id=pipeline-security-monitoring>Pipeline Security Monitoring<a class=headerlink href=#pipeline-security-monitoring title="Permanent link">&para;</a></h3> <pre class=mermaid><code>graph TD
    classDef source fill:#3498db, stroke:#333, stroke-width:1px, color:white
    classDef processing fill:#f39c12, stroke:#333, stroke-width:1px
    classDef storage fill:#2ecc71, stroke:#333, stroke-width:1px
    classDef analysis fill:#9b59b6, stroke:#333, stroke-width:1px, color:white

    A[Build Logs]:::source --&gt; X[Log Aggregation]:::processing
    B[Access Events]:::source --&gt; X
    C[Security Scans]:::source --&gt; X
    D[Deployment Events]:::source --&gt; X

    X --&gt; E[Security Data Lake]:::storage

    E --&gt; F[Anomaly Detection]:::analysis
    E --&gt; G[Compliance Reporting]:::analysis
    E --&gt; H[Threat Hunting]:::analysis
    E --&gt; I[Incident Investigation]:::analysis

    F --&gt; J[Alert Generation]
    G --&gt; K[Compliance Dashboard]
    H --&gt; L[Threat Intelligence]
    I --&gt; M[Incident Response]</code></pre> <p>Implementation considerations:</p> <ol> <li><strong>Centralized Logging</strong>: Collect logs from all pipeline components</li> <li><strong>Correlation</strong>: Link events across different pipeline stages</li> <li><strong>Baseline Establishment</strong>: Understand normal pipeline behavior</li> <li><strong>Detection Rules</strong>: Create alerts for suspicious patterns</li> <li><strong>Visualization</strong>: Build dashboards for pipeline security metrics</li> </ol> <h2 id=conclusion-and-recommended-actions_1>Conclusion and Recommended Actions<a class=headerlink href=#conclusion-and-recommended-actions_1 title="Permanent link">&para;</a></h2> <p>Securing CI/CD pipelines requires a comprehensive approach that addresses people, processes, and technology. Organizations should:</p> <ol> <li><strong>Assess your current state</strong> using the audit checklist provided</li> <li><strong>Create a roadmap</strong> for implementing missing controls</li> <li><strong>Prioritize high-impact changes</strong> such as access controls and secret management</li> <li><strong>Conduct regular security testing</strong> of the pipeline itself</li> <li><strong>Train developers and operations teams</strong> on secure CI/CD practices</li> <li><strong>Implement continuous monitoring</strong> to detect anomalies and security issues</li> <li><strong>Regularly review and update</strong> security controls as threats evolve</li> </ol> <p>By implementing these controls, organizations can significantly reduce the risk of supply chain attacks originating through their CI/CD pipelines, protecting both their own systems and their customers.</p> <div class="admonition info"> <p class=admonition-title>Additional Resources</p> <ul> <li><a href=https://slsa.dev/ >SLSA Framework</a></li> <li><a href=https://github.com/cncf/tag-security/tree/main/supply-chain-security>CNCF Software Supply Chain Best Practices</a></li> <li><a href=https://owasp.org/www-project-top-10-ci-cd-security-risks/ >OWASP CI/CD Security Top 10</a></li> <li><a href=https://buildpacks.io/ >Cloud Native Buildpacks</a></li> <li><a href=https://in-toto.io/ >In-toto Framework</a></li> <li><a href=https://csrc.nist.gov/publications/detail/sp/800-204c/draft>NIST SP 800-204C: Implementation of DevSecOps</a></li> </ul> </div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 18, 2025 12:40:27">May 18, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 18, 2025 08:34:59">May 18, 2025</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/harekrishnarai target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/harekrishnarai target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your preferences and analyze site traffic. We never collect any personal data or information other than technical data for performance.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.path", "navigation.sections", "navigation.expand", "navigation.prune", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "header.autohide"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../../assets/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>